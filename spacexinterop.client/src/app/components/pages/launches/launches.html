<section class="fade-in-anim table-section">
    <div class="launches-header">
        <div class="nav-link" (click)="showUpcomingOnly = false; pageIndex.set(0); paginator.firstPage(); fetchData();"
            [ngClass]="{'route-active': !showUpcomingOnly}"> Past </div>
        <div class="nav-link" (click)="showUpcomingOnly = true; pageIndex.set(0); paginator.firstPage();;;; fetchData();"
            [ngClass]="{'route-active': showUpcomingOnly}"> Upcoming </div>
    </div>

    <div class="table-controls">
        <mat-form-field appearance="outline">
            <mat-label>Search by Name </mat-label>
            <input matInput (keyup)="applyFilter($event)" placeholder="e.g. Falcon" />
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Sort</mat-label>
            <mat-select [(value)]="sortOrder" (selectionChange)="pageIndex.set(0); paginator.firstPage(); fetchData();">
                <mat-option [value]="SortDirectionEnum.Descending">Newest</mat-option>
                <mat-option [value]="SortDirectionEnum.Ascending">Oldest</mat-option>
            </mat-select>
        </mat-form-field>
    </div>

    <div class="table-container">
        <div class="table-body-wrapper">
            <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
                <ng-container [matColumnDef]="displayedColumns[0]">
                    <th mat-header-cell *matHeaderCellDef class="custom-header"> Patch </th>
                    <td mat-cell *matCellDef="let item">
                        <img [src]="item.missionPatchImage ?? './assets/images/no_patch_default.png'"
                            alt="Mission Patch" class="mission-patch-image" />
                    </td>
                </ng-container>

                <ng-container [matColumnDef]="displayedColumns[1]">
                    <th mat-header-cell *matHeaderCellDef class="custom-header"> Name </th>
                    <td mat-cell *matCellDef="let item">{{ item.name }}</td>
                </ng-container>

                <ng-container [matColumnDef]="displayedColumns[2]">
                    <th mat-header-cell *matHeaderCellDef class="custom-header"> Rocket Name </th>
                    <td mat-cell *matCellDef="let item">{{ item.rocketName }}</td>
                </ng-container>

                <ng-container [matColumnDef]="displayedColumns[3]">
                    <th mat-header-cell *matHeaderCellDef class="custom-header"> Launchpad Name </th>
                    <td mat-cell *matCellDef="let item">{{ item.launchpadName }}</td>
                </ng-container>

                <ng-container [matColumnDef]="displayedColumns[4]">
                    <th mat-header-cell *matHeaderCellDef class="custom-header"> Launch Date (UTC) </th>
                    <td mat-cell *matCellDef="let item">{{ item.launchDateUtc }}</td>
                </ng-container>

                <ng-container [matColumnDef]="displayedColumns[5]">
                    <th mat-header-cell *matHeaderCellDef class="custom-header"> Payloads </th>
                    <td mat-cell *matCellDef="let item">{{ item.payloads }}</td>
                </ng-container>

                <ng-container [matColumnDef]="displayedColumns[6]">
                    <th mat-header-cell *matHeaderCellDef class="custom-header"> Links </th>
                    <td mat-cell *matCellDef="let item">
                        @if(item.webcastUrl || item.wikipediaUrl || item.articleUrl) {
                        <div class="launches-links">
                            @if(item.webcastUrl) {
                            <div class="launches-link">
                                <img src="./assets/svg/youtube_icon.svg" alt="YouTube Icon" />
                                <a [href]="item.webcastUrl" target="_blank"> YouTube </a>
                            </div>
                            }
                            @if(item.wikipediaUrl) {
                            <div class="launches-link">
                                <img src="./assets/svg/wikipedia_icon.svg" alt="Wikipedia Icon" />
                                <a [href]="item.wikipediaUrl" target="_blank"> Wikipedia </a>
                            </div>
                            }
                            @if(item.articleUrl) {
                            <div class="launches-link">
                                <mat-icon> {{ MatIcons.Link }} </mat-icon>
                                <a [href]="item.articleUrl" target="_blank"> Article </a>
                            </div>
                            }
                        </div>
                        } @else {
                        {{ EMPTY_TABLE_FIELD_STRING }}
                        }
                    </td>
                </ng-container>

                <ng-container [matColumnDef]="displayedColumns[7]">
                    <th mat-header-cell *matHeaderCellDef class="custom-header"> Status </th>
                    <td mat-cell *matCellDef="let item">
                        @if(item.upcoming) {
                        <span class="status upcoming"> Upcoming </span>
                        } @else if (item.success === true) {
                        <span class="status success"> Success </span>
                        } @else if (item.success === false) {
                        <span class="status failed"> Failed </span>
                        } @else {
                        <span class="status unknown"> Unknown </span>
                        }
                    </td>
                </ng-container>

                <ng-container [matColumnDef]="displayedColumns[8]">
                    <th mat-header-cell *matHeaderCellDef class="custom-header"> Actions </th>
                    <td mat-cell *matCellDef="let item; let i = index">
                        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="More actions"
                            class="clickable-item"
                            #menuTrigger="matMenuTrigger"
                            (menuOpened)="menuOpenState[i] = true"
                            (menuClosed)="menuOpenState[i] = false">
                            <mat-icon [style.transform]="menuOpenState[i] ? 'rotate(-90deg)' : 'rotate(0deg)'" class="animated-icon">
                                {{ MatIcons.MoreActions }}
                            </mat-icon>
                        </button>

                        <mat-menu #menu="matMenu">
                            <button mat-menu-item
                                (click)="viewDetails(i); menuTrigger.closeMenu(); $event.preventDefault(); $event.stopPropagation();"
                                class="table-menu-item">
                                <mat-icon> {{ MatIcons.Info}} </mat-icon>
                                <span>View Details</span>
                            </button>
                        </mat-menu>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

                <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell mat-empty-table" [attr.colspan]="displayedColumns.length">
                        {{ EMPTY_TABLE_STRING }}
                    </td>
                </tr>
            </table>
        </div>

        <mat-paginator (page)="changePage($event)" [pageIndex]="pageIndex" [pageSize]="pageSize"
            [pageSizeOptions]="pageSizeOptions" showFirstLastButtons> </mat-paginator>
    </div>
</section>